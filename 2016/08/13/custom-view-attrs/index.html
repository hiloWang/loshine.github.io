<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="描述"><title>自定义View之自定义属性 | 饭窝</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">自定义View之自定义属性</h1><a id="logo" href="/.">饭窝</a><p class="description">活捉一只 Android 狗</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">自定义View之自定义属性</h1><div class="post-meta">Aug 13, 2016<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/08/13/custom-view-attrs/" href="/2016/08/13/custom-view-attrs/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#定义一个控件"><span class="toc-number">1.</span> <span class="toc-text">定义一个控件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#定义需要的属性"><span class="toc-number">2.</span> <span class="toc-text">定义需要的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#声明属性名称"><span class="toc-number">2.1.</span> <span class="toc-text">声明属性名称</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#获取属性"><span class="toc-number">3.</span> <span class="toc-text">获取属性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#构造方法"><span class="toc-number">3.1.</span> <span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#obtainStyledAttributes"><span class="toc-number">3.2.</span> <span class="toc-text">obtainStyledAttributes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参数解析"><span class="toc-number">3.2.1.</span> <span class="toc-text">参数解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#attrs"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">attrs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrbuteSet"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">AttrbuteSet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#defStyleAttrs"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">defStyleAttrs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#resId-defStyleRes"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">resId/defStyleRes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Null"><span class="toc-number">3.2.1.5.</span> <span class="toc-text">Null</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#四个参数"><span class="toc-number">3.2.1.6.</span> <span class="toc-text">四个参数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TypedArray"><span class="toc-number">3.3.</span> <span class="toc-text">TypedArray</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实例"><span class="toc-number">4.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考文章"><span class="toc-number">5.</span> <span class="toc-text">参考文章</span></a></li></ol></div></div><div class="post-content"><h1 id="定义一个控件"><a href="#定义一个控件" class="headerlink" title="定义一个控件"></a>定义一个控件</h1><p>我们先画一个简单的圆形 View，在<code>onDraw</code>中绘制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint mPaint;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequiresApi</span>(api = Build.VERSION_CODES.LOLLIPOP)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr, defStyleRes);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        mPaint = <span class="keyword">new</span> Paint();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        canvas.drawCircle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, mPaint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在布局文件中使用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">io.github.loshine.customview.view.CircleView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div></pre></td></tr></table></figure>
<p>然后我们就可以在 preview 窗口中看到效果了</p>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/blog-attr-circle-1.png" alt=""></p>
<p>一个很简单的黑色的圆形</p>
<h1 id="定义需要的属性"><a href="#定义需要的属性" class="headerlink" title="定义需要的属性"></a>定义需要的属性</h1><p>现在我觉得黑色不好看了，我想给它换个颜色，那么一般来说可以用<code>Paint.setColor(int color)</code>来修改为其它的颜色。但这会让所有的 CircleView 都变成另一个颜色。</p>
<p>但我可能希望在一个 Activity 里的 CircleView 是红色，但在另一个中的是蓝色。</p>
<p>此时我们就需要给该 View 自定义属性了。</p>
<p>自定义属性就类似 TextView 的<code>android:text=&quot;xxx&quot;</code>，ImageView 的<code>android:src=&quot;@drawable/xxx&quot;</code>，可以给相同类型的 View 设置不同的属性展示不同的效果。</p>
<p>这里我们定义一个 color 属性。</p>
<h2 id="声明属性名称"><a href="#声明属性名称" class="headerlink" title="声明属性名称"></a>声明属性名称</h2><p>在<code>res/values</code>文件夹下新建一个资源文件，叫 attrs.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">"CircleView"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"circle_color"</span> <span class="attr">format</span>=<span class="string">"color"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这样就完成了属性名称的声明。</p>
<p><code>declare-styleable</code>的 name 必须要对应 View 的类名，<code>attr</code>标签中定义的就是需要自定义的属性名称和类型。</p>
<p>我们有这几种类型：</p>
<ul>
<li>boolean</li>
<li>color</li>
<li>dimension</li>
<li>enum</li>
<li>flag</li>
<li>float</li>
<li>fraction</li>
<li>integer</li>
<li>reference</li>
<li>string</li>
</ul>
<p>声明完成之后就可以在代码中根据对应的方法获取布局中使用的自定义属性了。</p>
<h1 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h1><h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><p>我们在自定义 View 的时候 IDE 通常会提醒我们需要拥有构造函数，然后我们使用其智能提醒会发现有四个构造函数供我们选择：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context)</span></span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context, AttributeSet attrs)</span></span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span></span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span></span></div></pre></td></tr></table></figure>
<p>查看源码注释，我们知道这四个方法分别对应不同方式创建 View：</p>
<ul>
<li><code>View(context)</code>：直接在代码中 new 出来</li>
<li><code>View(context, attrs)</code>：当 View 是从布局文件 inflate 出来的时候会调用这个构造方法，使用默认的 style 和 theme。</li>
<li><code>View(context, attrs, defStyleAttr)</code>：该方法不会被系统直接调用，我们需要手动调用。该方法相比第二个方法多了一个默认 style 的参数，它的作用就是为 View 提供一个基本的样式。</li>
<li><code>View(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes)</code>：将资源文件中定义的某个样式作为默认样式。</li>
</ul>
<p>我们在实现自定义 View 的时候，通常至少有两个构造方法（至于为什么我们后文再说），分别是<code>View(Context context)</code>以及<code>View(Context context, AttrbuteSet attires)</code>，这样我们才可以在 Java 代码中以及在布局文件中（或使用 Inflater）实例化它们。</p>
<h2 id="obtainStyledAttributes"><a href="#obtainStyledAttributes" class="headerlink" title="obtainStyledAttributes"></a>obtainStyledAttributes</h2><p>看过了 View 的构造方法，我们现在就要在构造方法里获取 View 的参数了。<code>Context</code>这个类为我们提供了以下几个方法来获取属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">obtainAttributes(AttributeSet set, <span class="keyword">int</span>[] attrs) <span class="comment">// 从 layout 设置的属性集中获取 attrs 中的属性</span></div><div class="line">obtainStyledAttributes(<span class="keyword">int</span>[] attrs) <span class="comment">// 从系统主题中获取 attrs 中的属性</span></div><div class="line">obtainStyledAttributes(<span class="keyword">int</span> resId, <span class="keyword">int</span>[] attrs) <span class="comment">// 从资源文件定义的 style 中读取属性</span></div><div class="line">obtainStyledAttributes(AttributeSet set, <span class="keyword">int</span>[] attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes) <span class="comment">// 后面详细说这个方法</span></div></pre></td></tr></table></figure>
<p>我们了解一下这几个 API 的参数，然后就可以很方便的获取自定义属性了。</p>
<h3 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h3><h4 id="attrs"><a href="#attrs" class="headerlink" title="attrs"></a>attrs</h4><p>就是我们需要获取属性集中的哪些属性，通常我们会定义一个<code>&lt;styleable&gt;</code>来管理所有的<code>&lt;attr&gt;</code>，然后我们就可以用<code>R.styleable.someAttrs</code>来使用这个参数了。</p>
<h4 id="AttrbuteSet"><a href="#AttrbuteSet" class="headerlink" title="AttrbuteSet"></a>AttrbuteSet</h4><p>即我们在 xml 中定义的属性的集合，如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/dial_button"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"@string/dial"</span> /&gt;</div></pre></td></tr></table></figure>
<p>这里我们的每一条属性都会放到 AttrbuteSet 中去，当然自定义属性也不例外。需要注意的是，<code>style=&quot;@style/somestyle&quot;</code>这样添加的属性也是会放进去的。</p>
<blockquote>
<p>这也是我们必须要实现<code>View(Context context, AttrbuteSet attr)</code>的原因，因为我们需要把布局文件中定义的参数传进来处理。</p>
</blockquote>
<h4 id="defStyleAttrs"><a href="#defStyleAttrs" class="headerlink" title="defStyleAttrs"></a>defStyleAttrs</h4><p>这是自定义属性中可以让其在 Theme 中配置的关键，使用它作为参数会从当前 Theme 中去获取参数。</p>
<h4 id="resId-defStyleRes"><a href="#resId-defStyleRes" class="headerlink" title="resId/defStyleRes"></a>resId/defStyleRes</h4><p>直接从资源文件中定义的某个样式中读取。</p>
<h4 id="Null"><a href="#Null" class="headerlink" title="Null"></a>Null</h4><p>注意到我们有一个方法只需要<code>attrs</code>作为参数，那它的属性从哪里来呢？其实是我们可以直接在 Theme 中指定属性并且用这个方法获取属性。</p>
<h4 id="四个参数"><a href="#四个参数" class="headerlink" title="四个参数"></a>四个参数</h4><p><code>obtainStyledAttributes(AttributeSet set, int[] attrs, int defStyleAttr, int defStyleRes)</code>这个方法有四个参数，我们获取到的属性可能从四个地方来：布局文件(set), defStyleAttr(主题可配置样式), defStyleRes(默认样式), NULL(主题中直接获取)</p>
<p>如果一个属性在多个地方都被定义了，那么它们的优先级如下：</p>
<p><code>set</code>&gt;<code>defStyleAttr</code>&gt;<code>defStyleRes</code>&gt;<code>NULL</code></p>
<h2 id="TypedArray"><a href="#TypedArray" class="headerlink" title="TypedArray"></a>TypedArray</h2><p>通过<code>obtainStyledAttributes()</code>我们就拿到了 TypedValue，我们需要的属性都存在里面。然后我们可以对应声明的时候的类型，使用对应的<code>getXXX()</code>方法来获取自定义属性，之后我们就可以使用自定义属性来绘图了。</p>
<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><p>我们将上述的圆形控件修改为五种不同颜色的同心圆，然后使用上面的不同定义属性的方式来定义一遍并且使用。</p>
<p>首先我们的圆形 View 改成这样了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint mPaint;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mColor1 = Color.BLACK;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mColor2 = Color.BLACK;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mColor3 = Color.BLACK;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mColor4 = Color.BLACK;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mColor5 = Color.BLACK;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.CircleView,</div><div class="line">                defStyleAttr, R.style.default_style);</div><div class="line">        mColor1 = typedArray.getColor(R.styleable.CircleView_circle_color1, Color.BLACK);</div><div class="line">        mColor2 = typedArray.getColor(R.styleable.CircleView_circle_color2, Color.BLACK);</div><div class="line">        mColor3 = typedArray.getColor(R.styleable.CircleView_circle_color3, Color.BLACK);</div><div class="line">        mColor4 = typedArray.getColor(R.styleable.CircleView_circle_color4, Color.BLACK);</div><div class="line">        mColor5 = typedArray.getColor(R.styleable.CircleView_circle_color5, Color.BLACK);</div><div class="line">        typedArray.recycle();</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        mPaint = <span class="keyword">new</span> Paint();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        mPaint.setColor(mColor1);</div><div class="line">        canvas.drawCircle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, mPaint);</div><div class="line">        mPaint.setColor(mColor2);</div><div class="line">        canvas.drawCircle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">90</span>, mPaint);</div><div class="line">        mPaint.setColor(mColor3);</div><div class="line">        canvas.drawCircle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">80</span>, mPaint);</div><div class="line">        mPaint.setColor(mColor4);</div><div class="line">        canvas.drawCircle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">70</span>, mPaint);</div><div class="line">        mPaint.setColor(mColor5);</div><div class="line">        canvas.drawCircle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>, mPaint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在<code>attrs.xml</code>中如下定义：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">"CircleView"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 对应五个同心圆的颜色 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"circle_color1"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"circle_color2"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"circle_color3"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"circle_color4"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"circle_color5"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 定义 theme 可配置 style --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"circle_style"</span> <span class="attr">format</span>=<span class="string">"reference"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后我们的<code>style.xml</code>中是这样的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>@color/colorPrimary<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>@color/colorPrimaryDark<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorAccent"</span>&gt;</span>@color/colorAccent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- 配置style --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_style"</span>&gt;</span>@style/custom_theme<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 直接在主题中指定 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color1"</span>&gt;</span>#ff444444<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color2"</span>&gt;</span>#ff444444<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color3"</span>&gt;</span>#ff444444<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color4"</span>&gt;</span>#ff444444<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color5"</span>&gt;</span>#ff444444<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 主题中配置的style --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"custom_theme"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color1"</span>&gt;</span>#ff222222<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color2"</span>&gt;</span>#ff222222<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color3"</span>&gt;</span>#ff222222<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 直接在layout文件中引用的style，最后会被放到set中 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"myStyle"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color1"</span>&gt;</span>#ff111111<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color2"</span>&gt;</span>#ff111111<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"default_style"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color1"</span>&gt;</span>#ff333333<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color2"</span>&gt;</span>#ff333333<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color3"</span>&gt;</span>#ff333333<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"circle_color4"</span>&gt;</span>#ff333333<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在布局中我们是这样使用的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">io.github.loshine.customview.view.CircleView</span></span></div><div class="line">    <span class="attr">style</span>=<span class="string">"@style/myStyle"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">app:circle_color1</span>=<span class="string">"#ff00ffff"</span>/&gt;</div></pre></td></tr></table></figure>
<p>如上配置，我们效果如图所示：</p>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/custom_attr.png" alt=""></p>
<p>可以看出我们的 color4 没有起效果，这是因为使用了 defStyle，这个时候默认 Style 就不会起作用了。</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="http://www.jianshu.com/p/61b79e7f88fc" target="_blank" rel="external">深入理解Android 自定义attr Style styleable以及其应用</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://loshine.me/2016/08/13/custom-view-attrs/" data-id="cirtcdzgh0026k76es1hmbfew" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Android/">Android</a></div><div class="post-nav"><a href="/2016/06/01/night-mode-in-android/" class="next">夜间模式初探</a></div><div id="disqus_thread"><script>var disqus_shortname = 'loshine';
var disqus_identifier = '2016/08/13/custom-view-attrs/';
var disqus_title = '自定义View之自定义属性';
var disqus_url = 'http://loshine.me/2016/08/13/custom-view-attrs/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//loshine.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://loshine.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Android-Studio/" style="font-size: 15px;">Android Studio</a> <a href="/tags/jekyll/" style="font-size: 15px;">jekyll</a> <a href="/tags/github-pages/" style="font-size: 15px;">github-pages</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Volley/" style="font-size: 15px;">Volley</a> <a href="/tags/Kotlin/" style="font-size: 15px;">Kotlin</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/RIME/" style="font-size: 15px;">RIME</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/08/13/custom-view-attrs/">自定义View之自定义属性</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/01/night-mode-in-android/">夜间模式初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/22/measure-custom-view-in-android/">Anroid中的自定义View测量</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/01/guide-with-gradual-background/">背景色渐变的引导页</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/30/use-lambda-in-android/">在Android开发中使用Lambda表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/26/custom-view-in-android/">Anroid中的自定义View绘制</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/22/migrate-blog-to-hexo/">博客迁移到 Hexo</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/android-databinding-with-kotlin/">Kotlin与DataBinding协作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/01/delegated-properties-in-kotlin/">Kotlin中的委托属性</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/17/implements-parcelable-in-kotlin/">Kotlin中实现Parcelable</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//loshine.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">饭窝.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-75134925-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>