<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="描述"><title>Anroid中的自定义View绘制 | 饭窝</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Anroid中的自定义View绘制</h1><a id="logo" href="/.">饭窝</a><p class="description">活捉一只 Android 狗</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Anroid中的自定义View绘制</h1><div class="post-meta">Mar 26, 2016<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/03/26/custom-view-in-android/" href="/2016/03/26/custom-view-in-android/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#View绘制流程"><span class="toc-number">1.</span> <span class="toc-text">View绘制流程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三个绘图工具类简介"><span class="toc-number">2.</span> <span class="toc-text">三个绘图工具类简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Paint"><span class="toc-number">2.1.</span> <span class="toc-text">Paint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Canvas"><span class="toc-number">2.2.</span> <span class="toc-text">Canvas</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Path"><span class="toc-number">2.3.</span> <span class="toc-text">Path</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#开始绘制"><span class="toc-number">3.</span> <span class="toc-text">开始绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简单图形"><span class="toc-number">3.1.</span> <span class="toc-text">简单图形</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#矩形"><span class="toc-number">3.1.1.</span> <span class="toc-text">矩形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线段"><span class="toc-number">3.1.2.</span> <span class="toc-text">线段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#圆形"><span class="toc-number">3.1.3.</span> <span class="toc-text">圆形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#画布底色"><span class="toc-number">3.1.4.</span> <span class="toc-text">画布底色</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#复杂图形"><span class="toc-number">3.2.</span> <span class="toc-text">复杂图形</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#刻度尺"><span class="toc-number">3.2.1.</span> <span class="toc-text">刻度尺</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#手表表盘"><span class="toc-number">3.2.2.</span> <span class="toc-text">手表表盘</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="post-content"><blockquote>
<p>虽然我们在开发中基本可以用 Android 自带的各种控件实现绝大多数的功能，但难以避免还是有一些需求是自带的控件无法实现的。这个时候我们通常会想到去 Github 上寻找开源控件，但有的东西是有成熟的实现如：ViewPager 的 Indicator。而有的就没那么容易找到了。</p>
<p>还有就是虽然我们平时的一些需求可以使用图片资源代替，但过多的图片资源不仅会使得应用体积增大，还会使得加载的过程中消耗不少的系统资源（内存以及 CPU）—— 我曾经就这么干过，至少这种方法做东西很快（但也很坑）。</p>
<p>这个时候我们就应该想到自定义 View 了，下面就讲讲我在学习自定义 View 的一些心得体会吧。</p>
</blockquote>
<h1 id="View绘制流程"><a href="#View绘制流程" class="headerlink" title="View绘制流程"></a>View绘制流程</h1><p>View 的绘制是从 ViewRoot 的<code>performTraversals()</code>方法开始的，其执行过程可简单概括为根据之前所有设置好的状态，判断是否需要计算视图大小（measure）、是否需要重新安置视图的位置（layout），以及是否需要重绘（draw）视图，其流程图如下所示：</p>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/blog-pic-custom-view-flow.png" alt="流程图"></p>
<p>而我们今天讲的自定义 View 的绘制，主要就是在是否需要重新 draw 这一步来实现。</p>
<h1 id="三个绘图工具类简介"><a href="#三个绘图工具类简介" class="headerlink" title="三个绘图工具类简介"></a>三个绘图工具类简介</h1><p>要在自定义 View 中进行重新绘制，我们首先需要了解一下 Android 中的三个重要的绘图工具类，它们就是<code>Paint</code>(画笔)、<code>Canvas</code>(画布)以及<code>Path</code>(路径)。当然其实不仅仅只有这三个可以作用于画图和图像处理，但它们是最基础的。</p>
<h2 id="Paint"><a href="#Paint" class="headerlink" title="Paint"></a>Paint</h2><p>Paint 就是画笔，在 Android 图形绘制的时候，我们就好像真的有一个人拿着画笔把图像画出来一样，所以画笔这个类也给了我们和现实世界作画的时候一样的一些设定。</p>
<p>我们可以通过 Paint 来设定线宽(就像现实中画笔的粗细)、颜色(颜料)、透明度以及填充风格等。</p>
<p>我们可以通过它的构造函数来新建一个画笔</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Paint paint = <span class="keyword">new</span> Paint();</div></pre></td></tr></table></figure>
<p>然后对它进行一些设定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">paint.setARGB(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 设置 ARGB 颜色 int</span></div><div class="line">paint.setAlpha(<span class="number">0</span>); <span class="comment">// 设置透明度 int</span></div><div class="line">paint.setColor(getResources().getColor(android.R.color.black)); <span class="comment">// 设置颜色</span></div><div class="line">paint.setAntiAlias(<span class="keyword">true</span>); <span class="comment">// 开启抗锯齿</span></div><div class="line">paint.setDither(<span class="keyword">true</span>); <span class="comment">// 开启抖动处理，使得绘制的图形更清晰</span></div><div class="line">paint.setFilterBitmap(<span class="keyword">true</span>); <span class="comment">// 滤掉对Bitmap图像的优化操作,加快显示速度</span></div><div class="line">paint.setMaskFilter(maskFilter); <span class="comment">// 添加滤镜</span></div><div class="line">paint.setColorFilter(colorFilter); <span class="comment">// 设置颜色过滤器</span></div><div class="line">paint.setPathEffect(pathEffect); <span class="comment">// 设置路径效果(如虚线等)</span></div><div class="line">paint.setShader(shader); <span class="comment">// 设置渐变效果</span></div><div class="line">paint.setShadowLayer(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, Color.GRAY); <span class="comment">// 半径2,x,y 距离为2，颜色灰色的阴影</span></div><div class="line">paint.setStyle(Paint.Style.FILL_AND_STROKE); <span class="comment">// 画笔样式(内部、边框还是both，画封闭图形的时候比较重要)</span></div><div class="line">paint.setStrokeCap(Paint.Cap.SQUARE); <span class="comment">// 方形笔刷</span></div><div class="line">paint.setStrokeJoin(Paint.Join.MITER); <span class="comment">// 各图形的结合方式</span></div><div class="line">paint.setStrokeWidth(<span class="number">2</span>); <span class="comment">// 画笔粗细</span></div><div class="line">paint.setXfermode(xfermode); <span class="comment">// 图形重叠时的处理方式</span></div><div class="line">paint.setFakeBoldText(<span class="keyword">true</span>); <span class="comment">// 模拟粗体</span></div><div class="line">paint.setSubpixelText(<span class="keyword">true</span>); <span class="comment">// 提升文字在 LCD 的显示效果</span></div><div class="line">paint.setTextAlign(Paint.Align.CENTER); <span class="comment">// 文字对齐方向</span></div><div class="line">paint.setTextScaleX(<span class="number">0.5</span>); <span class="comment">// 文字 X 轴缩放</span></div><div class="line">paint.setTextSize(<span class="number">40</span>); <span class="comment">// 文字大小</span></div><div class="line">paint.setTextSkewX(<span class="number">30</span>); <span class="comment">// 文字倾斜度</span></div><div class="line">paint.setTypeface(Typeface.SANS_SERIF); <span class="comment">// 字体风格</span></div><div class="line">paint.setUnderlineText(<span class="keyword">true</span>); <span class="comment">// 下划线</span></div><div class="line">paint.setStrikeThruText(<span class="keyword">true</span>); <span class="comment">// 删除线</span></div><div class="line">paint.setStrokeJoin(Paint.Join.ROUND); <span class="comment">// 结合处风格</span></div><div class="line">paint.setStrokeMiter(<span class="number">30</span>); <span class="comment">// 画笔倾斜度</span></div><div class="line">paint.setStrokeCap(Paint.Cap.ROUND); <span class="comment">// 拐角处风格</span></div><div class="line">paint.ascent(); <span class="comment">// baseline之上至字符最高处的距离</span></div><div class="line">paint.descent(); <span class="comment">// baseline之下至字符最低处的距离</span></div><div class="line">paint.clearShadowLayer(); <span class="comment">// 清除阴影</span></div><div class="line"><span class="comment">// 等等</span></div></pre></td></tr></table></figure>
<p>但我们光有画笔还是不够的，我们至少还需要画布(Canvas)才可以真正开始作画呢。</p>
<h2 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h2><p>Canvas 就是画布，我们有了画笔和画布就可以开始作画(图形绘制)了。</p>
<p>我们有两种创建 Canvas 的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Canvas canvas = <span class="keyword">new</span> Canvas();</div><div class="line">Canvas canvasByBitmap = <span class="keyword">new</span> Canvas(bitmap);</div></pre></td></tr></table></figure>
<p>其中传入 Bitmap 的方法会将 Bitmap 作为画布的背景。</p>
<p>下面是常用的<code>drawXXX()</code>方法，它们被用于绘制不同的图形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">canvas.drawRect(<span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>), mPaint); <span class="comment">// 绘制一个方形</span></div><div class="line">canvas.drawRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>, mPaint); <span class="comment">// 绘制一个方形</span></div><div class="line">canvas.drawPath(path, paint); <span class="comment">// 绘制一个路径</span></div><div class="line">canvas.drawBitmap(bitmap, src, dst, mPaint); <span class="comment">// 第二和第三个参数是 Rect</span></div><div class="line">canvas.drawLine(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>, mPaint); <span class="comment">// 画线</span></div><div class="line">canvas.drawPoint(<span class="number">100</span>, <span class="number">20</span>, mPaint); <span class="comment">// 画点</span></div><div class="line">canvas.drawText(<span class="string">"这是一段文字"</span>, <span class="number">0</span>, <span class="number">0</span>, mPaint); <span class="comment">// 画文字</span></div><div class="line">canvas.drawOval(<span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">200</span>), mPaint); <span class="comment">// 画方形的内切椭圆</span></div><div class="line">canvas.drawCircle(<span class="number">300</span>, <span class="number">300</span>, <span class="number">100</span>, mPaint); <span class="comment">// 画圆</span></div><div class="line">canvas.drawArc(<span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>), <span class="number">0</span>, <span class="number">30</span>, <span class="keyword">true</span>, mPaint); <span class="comment">// 一个矩形内的扇形</span></div></pre></td></tr></table></figure>
<p>还有<code>clipXXX()</code>方法，它们是裁剪一块新的区域用于绘图，这里就不详细说明了。</p>
<p><code>save()</code>和<code>restore()</code>方法用来保存和恢复 Canvas 的状态，简单而言就是一个存档，一个恢复存档。</p>
<p>还有就是三个变换方法：<code>translate</code>(平移)、<code>scale</code>(缩放)以及<code>rotate</code>(旋转)了，它们可以控制画布的一些动作，就好像我们真实世界中作画的时候对画布的一些动作一样(除了缩放，2333)。</p>
<h2 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h2><p>其实在有了上面两个类之后我们就已经可以开始绘制了，但还是先把 Path 也介绍完毕之后再开始真实案例吧。</p>
<p>Path 就是路径，有点像我们在初中数学中学习函数的时候，可以根据几个点确认画出一个函数的图形。</p>
<p>下面是一些常用的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">path.addArc(<span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>), <span class="number">0</span>, <span class="number">30</span>); <span class="comment">// 添加一段圆弧</span></div><div class="line">path.addCircle(<span class="number">300</span>, <span class="number">300</span>, <span class="number">100</span>, Path.Direction.CW); <span class="comment">// 顺时针圆</span></div><div class="line">path.addOval(rectF, Path.Direction.CCW); <span class="comment">// 逆时针椭圆</span></div><div class="line">path.addRect(rectF, Path.Direction.CW); <span class="comment">// 添加矩形</span></div><div class="line">path.addRoundRect(rectF, &#123;<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>&#125;, path.Direction.CW); <span class="comment">// 添加圆角矩形</span></div><div class="line">path.isEmpty(); <span class="comment">// 是否无路径</span></div><div class="line">path.transform(matrix); <span class="comment">// 矩阵变换</span></div><div class="line">path.moveTo(<span class="number">100</span>, <span class="number">100</span>); <span class="comment">// 移动画笔而不绘制</span></div><div class="line">path.lineTo(<span class="number">300</span>, <span class="number">300</span>); <span class="comment">// 默认从(0，0)开始绘制,可以用 moveTo 移动起始点,调用 canvas.drawPath(path, paint) 绘制</span></div><div class="line">path.quadTo(x1, y1, x2, y2); <span class="comment">// 绘制贝塞尔曲线,三点(起始点默认(0, 0))确认</span></div><div class="line">path.rCubicTo(x1, y1, x2, y2, x3, y3); <span class="comment">// 多一个控制点的贝塞尔曲线</span></div><div class="line">path.arcTo(rectF, <span class="number">0</span>, <span class="number">50</span>); <span class="comment">// 圆弧</span></div></pre></td></tr></table></figure>
<h1 id="开始绘制"><a href="#开始绘制" class="headerlink" title="开始绘制"></a>开始绘制</h1><p>介绍完了三个绘制 UI 的基础类，那么我们现在来动手试试吧。难度从低到高，循序渐进完成自定义 View 中复杂图形的绘制。</p>
<p>我们自定义一个 View 并且要重新绘制的话，我们只需要新建一个类<strong>继承</strong> View 并且实现<code>onDraw(Canvas canvas)</code>即可，View 会调用子类实现的<code>onDraw</code>完成绘制。</p>
<p>那么我们接下来的示例就只列出<code>onDraw</code>方法和对应的效果图了。</p>
<h2 id="简单图形"><a href="#简单图形" class="headerlink" title="简单图形"></a>简单图形</h2><h3 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">    <span class="comment">// 在构造函数中初始化画笔并设置为黑色</span></div><div class="line">    canvas.drawRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">200</span>, mPaint);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/blog-pic-custom-view-1.png" alt="黑色矩形"></p>
<h3 id="线段"><a href="#线段" class="headerlink" title="线段"></a>线段</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">    canvas.drawLine(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">200</span>, mPaint);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/blod-pic-custom-view-2.png" alt="线段"></p>
<h3 id="圆形"><a href="#圆形" class="headerlink" title="圆形"></a>圆形</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">    canvas.drawCircle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, mPaint);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/blog-pic-custom-view-3.png" alt="圆形"></p>
<h3 id="画布底色"><a href="#画布底色" class="headerlink" title="画布底色"></a>画布底色</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">    canvas.drawColor(getResources().getColor(android.R.color.darker_gray));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/blod-pic-custom-view-4.png" alt="画布底色"></p>
<h2 id="复杂图形"><a href="#复杂图形" class="headerlink" title="复杂图形"></a>复杂图形</h2><h3 id="刻度尺"><a href="#刻度尺" class="headerlink" title="刻度尺"></a>刻度尺</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">    <span class="comment">// 防止数字0出界</span></div><div class="line">    canvas.translate(<span class="number">0</span>, <span class="number">50</span>);</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">100</span>; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// 带有数字的长刻度</span></div><div class="line">            canvas.drawLine(<span class="number">0</span>, <span class="number">0</span>, <span class="number">70</span>, <span class="number">0</span>, mPaint);</div><div class="line">            <span class="comment">// 画文字</span></div><div class="line">            canvas.drawText(String.format(Locale.CHINESE, <span class="string">"%d"</span>, i / <span class="number">10</span>), <span class="number">100</span>, <span class="number">10</span>, mPaint);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i % <span class="number">5</span> == <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// 每隔5的中等长度的刻度</span></div><div class="line">            canvas.drawLine(<span class="number">0</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">0</span>, mPaint);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 其它小刻度</span></div><div class="line">            canvas.drawLine(<span class="number">0</span>, <span class="number">0</span>, <span class="number">30</span>, <span class="number">0</span>, mPaint);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 每个刻度画完之后位移</span></div><div class="line">        canvas.translate(<span class="number">0</span>, <span class="number">15</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/blog-pic-custom-view-5.png" alt="刻度尺"></p>
<h3 id="手表表盘"><a href="#手表表盘" class="headerlink" title="手表表盘"></a>手表表盘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">    <span class="comment">// 绘制外圈圆</span></div><div class="line">    canvas.drawCircle(<span class="number">400</span>, <span class="number">400</span>, <span class="number">400</span>, mPaint);</div><div class="line"></div><div class="line">    <span class="comment">// 绘制分针和时针</span></div><div class="line">    canvas.drawLine(<span class="number">400</span>, <span class="number">400</span>, <span class="number">400</span>, <span class="number">200</span>, mPaint);</div><div class="line">    canvas.drawLine(<span class="number">400</span>, <span class="number">400</span>, <span class="number">550</span>, <span class="number">400</span>, mPaint);</div><div class="line"></div><div class="line">    <span class="comment">// 绘制刻度和文字</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; i++) &#123;</div><div class="line">        canvas.drawLine(<span class="number">400</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">10</span>, mPaint);</div><div class="line">        canvas.drawText(String.format(Locale.CHINESE, <span class="string">"%d"</span>, i == <span class="number">0</span> ? <span class="number">12</span> : i),</div><div class="line">                <span class="number">400</span>, <span class="number">100</span>, mTextPaint);</div><div class="line">        <span class="comment">// 旋转画布</span></div><div class="line">        canvas.rotate(<span class="number">30</span>, <span class="number">400</span>, <span class="number">400</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xl94a.com1.z0.glb.clouddn.com/blog-pic-custom-view-6.png" alt="表盘"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>其实 Android 中的图形绘制基本就是靠这三个类扩展变化而来，掌握了它们的使用方式我们也就可以定义各种各样的好看的自定义控件了。</p>
<p>那么我们掌握了绘制之后，我们还要考虑的就是自定义 View 的测量了，我会在之后再写一篇博文来总结我学习自定义 View 的测量的一些经验，感谢观看（虽然并不会有多少人看……）。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://loshine.me/2016/03/26/custom-view-in-android/" data-id="cirtcdzg7001pk76euqv58gjq" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Android/">Android</a></div><div class="post-nav"><a href="/2016/03/30/use-lambda-in-android/" class="pre">在Android开发中使用Lambda表达式</a><a href="/2016/03/22/migrate-blog-to-hexo/" class="next">博客迁移到 Hexo</a></div><div id="disqus_thread"><script>var disqus_shortname = 'loshine';
var disqus_identifier = '2016/03/26/custom-view-in-android/';
var disqus_title = 'Anroid中的自定义View绘制';
var disqus_url = 'http://loshine.me/2016/03/26/custom-view-in-android/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//loshine.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://loshine.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Android-Studio/" style="font-size: 15px;">Android Studio</a> <a href="/tags/jekyll/" style="font-size: 15px;">jekyll</a> <a href="/tags/github-pages/" style="font-size: 15px;">github-pages</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Volley/" style="font-size: 15px;">Volley</a> <a href="/tags/Kotlin/" style="font-size: 15px;">Kotlin</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/RIME/" style="font-size: 15px;">RIME</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/08/13/custom-view-attrs/">自定义View之自定义属性</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/01/night-mode-in-android/">夜间模式初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/22/measure-custom-view-in-android/">Anroid中的自定义View测量</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/01/guide-with-gradual-background/">背景色渐变的引导页</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/30/use-lambda-in-android/">在Android开发中使用Lambda表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/26/custom-view-in-android/">Anroid中的自定义View绘制</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/22/migrate-blog-to-hexo/">博客迁移到 Hexo</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/android-databinding-with-kotlin/">Kotlin与DataBinding协作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/01/delegated-properties-in-kotlin/">Kotlin中的委托属性</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/17/implements-parcelable-in-kotlin/">Kotlin中实现Parcelable</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//loshine.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">饭窝.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-75134925-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>